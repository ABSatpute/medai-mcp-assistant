<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug MedAI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <h1>üîß MedAI Debug Mode</h1>
    
    <div id="debug-log" style="background: #f0f0f0; padding: 10px; margin: 10px 0; height: 200px; overflow-y: scroll;"></div>
    
    <h2>Step 1: Basic Elements</h2>
    <input type="text" id="messageInput" placeholder="Type message here..." style="width: 300px; padding: 10px;">
    <button onclick="testInput()">Test Input</button>
    
    <h2>Step 2: Socket Connection</h2>
    <button onclick="testSocket()">Test Socket</button>
    <div id="socket-status">Not tested</div>
    
    <h2>Step 3: Welcome Cards</h2>
    <div class="welcome-card" onclick="testWelcomeCard('Find medicines near me')" style="border: 1px solid #ccc; padding: 10px; margin: 5px; cursor: pointer;">
        <i class="fas fa-pills"></i> Medicine Search (Click to test)
    </div>
    <div class="welcome-card" onclick="testWelcomeCard('Show me nearby medical stores')" style="border: 1px solid #ccc; padding: 10px; margin: 5px; cursor: pointer;">
        <i class="fas fa-map-marker-alt"></i> Store Locator (Click to test)
    </div>
    
    <h2>Step 4: MedAI Class</h2>
    <button onclick="testMedAI()">Test MedAI Initialization</button>
    
    <script>
        let debugLog = document.getElementById('debug-log');
        let socket = null;
        let medAI = null;
        
        function log(message) {
            console.log(message);
            debugLog.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        log('üöÄ Debug page loaded');
        
        function testInput() {
            const input = document.getElementById('messageInput');
            if (input) {
                log('‚úÖ Message input found: ' + input.value);
            } else {
                log('‚ùå Message input NOT found');
            }
        }
        
        function testSocket() {
            log('üîå Testing socket connection...');
            socket = io();
            
            socket.on('connect', () => {
                log('‚úÖ Socket connected successfully');
                document.getElementById('socket-status').innerHTML = '‚úÖ Connected';
            });
            
            socket.on('disconnect', () => {
                log('‚ùå Socket disconnected');
                document.getElementById('socket-status').innerHTML = '‚ùå Disconnected';
            });
            
            socket.on('message_received', (data) => {
                log('üì® Message received: ' + JSON.stringify(data));
            });
        }
        
        function testWelcomeCard(message) {
            log('üéØ Welcome card clicked: ' + message);
            
            const input = document.getElementById('messageInput');
            if (input) {
                input.value = message;
                log('‚úÖ Message set in input');
                
                if (socket && socket.connected) {
                    log('üì§ Sending message via socket...');
                    socket.emit('send_message', {
                        thread_id: 'debug-thread',
                        message: message,
                        location: null
                    });
                } else {
                    log('‚ùå Socket not connected - run socket test first');
                }
            } else {
                log('‚ùå Cannot set message - input not found');
            }
        }
        
        function testMedAI() {
            log('ü§ñ Testing MedAI class initialization...');
            try {
                // Simple version of MedAI for testing
                class TestMedAI {
                    constructor() {
                        log('üöÄ TestMedAI constructor called');
                        this.socket = io();
                        this.currentThreadId = 'test-thread';
                        log('‚úÖ TestMedAI initialized');
                    }
                    
                    sendMessage() {
                        log('üì§ TestMedAI sendMessage called');
                        const input = document.getElementById('messageInput');
                        const message = input.value.trim();
                        
                        if (!message) {
                            log('‚ùå No message to send');
                            return;
                        }
                        
                        log('üöÄ Emitting message: ' + message);
                        this.socket.emit('send_message', {
                            thread_id: this.currentThreadId,
                            message: message,
                            location: null
                        });
                    }
                }
                
                medAI = new TestMedAI();
                log('‚úÖ MedAI test class created successfully');
                
                // Test sending a message
                document.getElementById('messageInput').value = 'Test message from MedAI';
                medAI.sendMessage();
                
            } catch (error) {
                log('‚ùå MedAI test failed: ' + error.message);
            }
        }
        
        // Auto-run basic tests
        setTimeout(() => {
            log('üîç Auto-testing basic elements...');
            testInput();
        }, 500);
    </script>
</body>
</html>
